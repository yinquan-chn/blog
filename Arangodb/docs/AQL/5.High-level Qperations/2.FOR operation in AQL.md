[FOR operation in AQL](https://docs.arangodb.com/3.11/aql/high-level-operations/for/)

# FOR 操作
通用的FOR操作可以遍历集合或视图、数组的元素或遍历图

## 语法
1、在集合和数组上迭代的通用语法是：

```
FOR variableName IN expression
```

2、图遍历还有一个特殊的[变体](https://docs.arangodb.com/3.11/aql/graphs/traversals/)：
```
FOR vertexVariableName [, edgeVariableName [, pathVariableName ] ] IN traversalExpression
```

3、对于“视图”，有一个特殊（可选）的SEARCH关键字：
```
FOR variableName IN viewName SEARCH searchExpression
```
在遍历中视图不能用作边集合：
```
FOR v IN 1..3 ANY startVertex viewName /* invalid! */
```

所有变体都可以选择以OPTIONS｛…｝子句结尾。

## 使用
表达式返回的每个数组元素只访问一次。要求表达式在所有情况下都返回一个数组。空数组也是允许的。当前数组元素可在variableName指定的变量中进行进一步处理。
```
FOR u IN users
  RETURN u
```
这将迭代users数组的所有元素(在这个例子中，数组 users 包含了从名为“users”的集合中获取的所有文档对象)。在遍历过程中，对于数组中的每一个元素（即集合中的每一条记录），都将该元素的值赋予变量 u。在此示例中并没有对变量 u 进行任何修改操作，而是通过 RETURN 关键字将其原封不动地添加到结果集中。

注意：当像这里所示那样遍历基于集合的数组时，如果不使用 SORT 语句明确定义排序顺序，则文档的排列顺序是不确定的。

FOR引入的变量在FOR所在的范围关闭之前一直可用。

另一个使用静态声明的值数组进行迭代的示例：
```
FOR year IN [ 2011, 2012, 2013 ]
  RETURN { "year" : year, "isLeapYear" : year % 4 == 0 && (year % 100 != 0 || year % 400 == 0) }
```

嵌套使用多个FOR循环也是允许的。当FOR循环进行嵌套时，各个独立FOR循环返回的数组元素将生成一个笛卡尔积（cross product）。这意味着每个内部循环的每次迭代都会与外部循环的所有可能值组合，从而创建出所有可能的组合结果
```
FOR u IN users
  FOR l IN locations
    RETURN { "user" : u, "location" : l }
```
在这个例子中，外部循环遍历users数组的每个用户元素，并在每次迭代时将当前用户赋值给变量u。内部循环则对应于locations数组，它会为users数组中的每一个用户元素遍历一遍所有的地点。
因此，如果users数组有3个用户，而locations数组有4个地点，则总共会产生3（来自用户数组）乘以4（来自地点数组）共12次迭代。在每次内部循环迭代时，都会使用当前用户的值（存储在u中）和当前地点的值（存储在l中），进行进一步的处理或计算

另请参阅将[查询与子查询组合](https://docs.arangodb.com/3.11/aql/fundamentals/subqueries/)